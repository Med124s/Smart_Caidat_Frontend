<div class="mb-4 flex items-center justify-between">
  <!-- Titre + compteur -->
  <div>
    <h3 class="text-foreground text-lg font-semibold">Demandes</h3>
    <div class="text-muted-foreground text-xs font-medium">
      <span>Toutes les demandes: </span>
      <span class="text-foreground font-semibold">{{ totalItems() }}</span>
    </div>
  </div>

  <!-- Actions principales -->
  <div class="flex items-center gap-2">
    <!-- Export CSV -->
    <!-- <button class="bg-muted text-muted-foreground hover:text-foreground rounded-md px-3 py-2 text-xs font-semibold">
      Exporter CSV
    </button> -->

    <!-- Ajouter -->
    <button class="bg-primary text-primary-foreground rounded-md px-3 py-2 text-xs font-semibold" (click)="showCreateModal()">
      + Ajouter Demande
    </button>
  </div>
</div>

<!-- Modal -->

<app-request-document
  [hidden]="!showModal"
  [request]="selectedRequest()"
  [mode]="modalMode"
  (save)="saveRequest($event)"
  (close)="showModal = false">
</app-request-document>

<!-- Table -->
<div class="border-muted/20 bg-background flex min-w-full flex-col rounded-xl border p-2">
  <!-- Actions filtrage / recherche -->
  <!-- <app-archive-table-action
    [selectedIds]="selectedIds()"
    (search)="onSearch($event)"
    (filter)="onFilter($event)"
    [selectedArchives]="selectedArchives"
    (deleteSelected)="onDeleteSelected($event)">
  </app-archive-table-action> -->

<app-request-table-action
  [selectedIds]="selectedIds()"
  [selectedRequests]="selectedRequests"
  (search)="onSearch($event)"
  (startDateChange)="onStartDateChange($event)"
  (endDateChange)="onEndDateChange($event)"
  (deleteSelected)="onDeleteSelected($event)">
</app-request-table-action>
  <!-- Table -->
  <div
    class="scrollbar-thumb-rounded scrollbar-track-rounded scrollbar-thin scrollbar-track-transparent scrollbar-thumb-muted grow overflow-x-auto px-5">
    <table
      class="text-muted-foreground table w-full table-auto border-collapse border-0 text-left align-middle leading-5">
      <thead class="border-muted/20 text-muted-foreground border text-xs">
        <!-- <tr app-archive-table-header  (onCheck)="toggleAllSelection($event)"></tr> -->
        <!-- <tr app-request-table-header [requestIds]="visibleRequestIds"></tr> -->
        <tr app-request-table-header ></tr>
      </thead>

      <!-- Rows -->
      <tbody>
        @for (request of visibleRequests || []; track $index) {
        <!-- <tr
          class="hover:bg-card/50"
          app-request-table-row
          [request]="request"
          [selectedRequests]="selectedRequests"
          (onDeleteSelected)="onDeleteSelected($event)"
          (detailRequest)="detailRequest($event)"></tr> -->
               <tr
          class="hover:bg-card/50"
          app-request-table-row
          [request]="request"
          [selectedRequests]="selectedRequests"
          (onDeleteSelected)="onDeleteSelected($event)"
          (onUpdateStatus)="handleStatusUpdate($event)"
          ></tr>
        } @empty {
        <tr>
          <td class="py-4 text-center text-sm" colspan="7">ðŸš« Aucune demande trouvÃ©e</td>
        </tr>
        }
      </tbody>
    </table>

    <!-- Loader -->
    @if (loadingSearch()) {
    <div class="py-6 text-center text-gray-600">
      <div class="inline-flex items-center gap-2">
        <div class="h-5 w-5 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"></div>
        <span>Chargement...</span>
      </div>
    </div>
    }
  </div>

  <!-- Pagination -->
  <app-request-table-footer
    [currentPage]="searchPage.page"
    [totalPages]="totalPages()"
    [totalItems]="totalItems()"
    [size]="searchPage.size"
    (pageChange)="onPageChange($event)"
    (sizeChange)="onSizeChange($event)">
  </app-request-table-footer>

</div>
